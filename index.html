<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…¨èƒ½æ—¥èªä¼´ (N1-N5 å®Œæ•´ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', 'Noto Sans JP', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .jp-font { font-family: 'Noto Sans JP', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        /* è®€å–å‹•ç•« */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #6366f1;
            width: 24px;
            height: 24px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <div id="app" class="max-w-md mx-auto w-full h-full bg-white shadow-2xl relative flex flex-col">
        
        <header class="bg-indigo-600 text-white p-4 shadow-md z-20 flex-none flex justify-between items-center">
            <h1 class="text-lg font-bold flex items-center gap-2">
                <span>ğŸ‡¯ğŸ‡µ</span> {{ pageTitle }}
            </h1>
            <span class="text-xs bg-indigo-500 px-2 py-1 rounded text-indigo-100">
               {{ currentTab === 'vocab' ? currentLevel.toUpperCase() : 'APP' }}
            </span>
        </header>

        <main class="flex-1 overflow-y-auto overflow-x-hidden bg-slate-50 relative scroll-smooth pb-24" ref="mainScroll">
            
            <div v-show="currentTab === 'talk'" class="p-4 space-y-4">
                <div class="flex overflow-x-auto gap-2 pb-2 no-scrollbar">
                    <button v-for="cat in conversationCats" :key="cat.id" 
                        @click="currConvCat = cat.id"
                        :class="['px-4 py-2 rounded-full whitespace-nowrap text-sm font-bold transition-all border', 
                        currConvCat === cat.id ? 'bg-indigo-600 text-white border-indigo-600' : 'bg-white text-gray-500 border-gray-200']">
                        {{ cat.name }}
                    </button>
                </div>

                <div v-for="(item, idx) in filteredConversations" :key="idx" @click="speak(item.jp)"
                    class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 active:scale-[0.98] transition-transform flex items-center gap-3 cursor-pointer group hover:bg-indigo-50">
                    <div class="bg-indigo-100 text-indigo-600 p-3 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
                    </div>
                    <div>
                        <div class="jp-font text-lg font-bold text-slate-800">{{ item.jp }}</div>
                        <div class="text-xs text-indigo-500 font-mono mb-1">{{ item.reading }}</div>
                        <div class="text-sm text-slate-500">{{ item.meaning }}</div>
                    </div>
                </div>
            </div>

            <div v-show="currentTab === 'kana'" class="p-4">
                <div class="flex bg-gray-200 rounded-lg p-1 mb-4">
                    <button @click="kanaMode = 'hira'" :class="['flex-1 py-2 text-sm font-bold rounded-md transition-all', kanaMode === 'hira' ? 'bg-white shadow text-indigo-600' : 'text-gray-500']">å¹³å‡å (ã‚)</button>
                    <button @click="kanaMode = 'kata'" :class="['flex-1 py-2 text-sm font-bold rounded-md transition-all', kanaMode === 'kata' ? 'bg-white shadow text-indigo-600' : 'text-gray-500']">ç‰‡å‡å (ã‚¢)</button>
                </div>

                <div class="grid grid-cols-5 gap-2 text-center">
                    <div v-for="(k, idx) in currentKanaList" :key="idx" 
                        @click="speak(k.char)"
                        :class="['aspect-square rounded-xl flex flex-col justify-center items-center shadow-sm border cursor-pointer active:scale-90 transition-transform select-none',
                        k.char ? 'bg-white border-slate-200 hover:border-indigo-400 hover:bg-indigo-50' : 'bg-transparent border-none shadow-none']">
                        <span class="jp-font text-xl font-bold text-slate-700">{{ k.char }}</span>
                        <span class="text-[10px] text-gray-400 font-mono uppercase mt-1">{{ k.romaji }}</span>
                    </div>
                </div>
            </div>

            <div v-show="currentTab === 'vocab'" class="flex flex-col min-h-full">
                <div class="p-4 bg-white border-b sticky top-0 z-10 shadow-sm">
                    <div class="flex justify-between gap-1 mb-3">
                        <button v-for="n in ['n5', 'n4', 'n3', 'n2', 'n1']" :key="n"
                            @click="loadVocabLevel(n)"
                            :class="['flex-1 py-2 text-xs font-bold rounded-lg uppercase tracking-wider border transition-all',
                            currentLevel === n ? 'bg-indigo-600 text-white border-indigo-600 shadow-md' : 'bg-white text-gray-500 border-gray-200']">
                            {{ n }}
                        </button>
                    </div>
                    <div class="relative">
                        <span class="absolute left-3 top-2.5 text-gray-400">ğŸ”</span>
                        <input v-model="searchQuery" placeholder="æœå°‹æ¼¢å­—ã€å‡åæˆ–æ„æ€..." 
                            class="w-full bg-slate-100 border-none rounded-lg pl-9 pr-4 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition-shadow">
                        <button v-if="searchQuery" @click="searchQuery = ''" class="absolute right-3 top-2.5 text-gray-400 text-xs bg-slate-200 rounded-full px-1.5">âœ•</button>
                    </div>
                </div>

                <div class="p-4 space-y-3 flex-1">
                    <div v-if="loading" class="flex flex-col items-center justify-center py-20 text-gray-400">
                        <div class="loader mb-3"></div>
                        <p class="text-sm">æ­£åœ¨å¾ GitHub ä¸‹è¼‰ {{ currentLevel.toUpperCase() }} å–®å­—åº«...</p>
                        <p class="text-xs text-gray-300 mt-1">ç¬¬ä¸€æ¬¡è¼‰å…¥å¯èƒ½éœ€è¦å¹¾ç§’é˜</p>
                    </div>
                    
                    <div v-else-if="filteredVocab.length === 0" class="text-center py-10 text-gray-400 text-sm">
                        <p>æ‰¾ä¸åˆ°ç¬¦åˆçš„å–®å­—</p>
                    </div>

                    <div v-else>
                        <div class="text-right text-xs text-gray-400 mb-2">
                             {{ filteredVocab.length }} å€‹å–®å­—
                        </div>
                        
                        <div v-for="(word, idx) in filteredVocab.slice(0, 100)" :key="idx" @click="speak(word.kana || word.kanji)"
                            class="bg-white border-l-4 border-emerald-500 p-3 pl-4 rounded-r-lg shadow-sm mb-3 flex justify-between items-start cursor-pointer active:bg-gray-50 hover:shadow-md transition-all">
                            <div class="flex-1">
                                <div class="flex flex-col">
                                    <span class="jp-font text-lg font-bold text-gray-800">{{ word.kanji || word.kana }}</span>
                                    <span v-if="word.kanji" class="text-xs text-indigo-600 font-mono">{{ word.kana }}</span>
                                </div>
                                <div class="text-sm text-gray-600 mt-1 leading-snug">{{ word.meaning }}</div>
                            </div>
                            <span class="text-gray-300 ml-2 mt-1">ğŸ”Š</span>
                        </div>
                        
                        <div v-if="filteredVocab.length > 100" class="text-center py-4">
                            <button class="text-xs text-indigo-500 font-bold bg-indigo-50 px-4 py-2 rounded-full">
                                è«‹ä½¿ç”¨æœå°‹æŸ¥çœ‹æ›´å¤š (å…± {{ filteredVocab.length }} ç­†)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <nav class="bg-white border-t border-gray-200 flex justify-around items-center p-2 pb-safe z-30 flex-none safe-bottom shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
            <button @click="switchTab('talk')" :class="['flex flex-col items-center p-2 w-full transition-colors', currentTab === 'talk' ? 'text-indigo-600' : 'text-gray-400']">
                <span class="text-2xl">ğŸ’¬</span>
                <span class="text-[10px] font-bold mt-1">æ—…éŠæœƒè©±</span>
            </button>
            <button @click="switchTab('kana')" :class="['flex flex-col items-center p-2 w-full transition-colors', currentTab === 'kana' ? 'text-indigo-600' : 'text-gray-400']">
                <span class="text-2xl">ã‚</span>
                <span class="text-[10px] font-bold mt-1">äº”åéŸ³è¡¨</span>
            </button>
            <button @click="switchTab('vocab')" :class="['flex flex-col items-center p-2 w-full transition-colors', currentTab === 'vocab' ? 'text-indigo-600' : 'text-gray-400']">
                <span class="text-2xl">ğŸ“š</span>
                <span class="text-[10px] font-bold mt-1">JLPTå–®å­—</span>
            </button>
        </nav>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentTab: 'talk',
                    
                    // --- 1. æœƒè©±è³‡æ–™ (ç²¾é¸æ—…éŠå¯¦ç”¨å¥) ---
                    currConvCat: 'basic',
                    conversationCats: [
                        {id: 'basic', name: 'ğŸ‘‹ åŸºç¤'}, {id: 'food', name: 'ğŸœ é¤å»³'}, 
                        {id: 'shop', name: 'ğŸ›ï¸ è³¼ç‰©'}, {id: 'hotel', name: 'ğŸ¨ ä½å®¿'}, {id: 'traffic', name: 'ğŸš… äº¤é€š'}
                    ],
                    conversations: [
                        { cat: 'basic', jp: 'ã™ã¿ã¾ã›ã‚“', reading: 'Sumimasen', meaning: 'ä¸å¥½æ„æ€ / è«‹å•' },
                        { cat: 'basic', jp: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™', reading: 'Arigatou gozaimasu', meaning: 'éå¸¸æ„Ÿè¬' },
                        { cat: 'basic', jp: 'è‹±èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', reading: 'Eigo menyu wa arimasu ka?', meaning: 'æœ‰è‹±æ–‡èœå–®å—ï¼Ÿ' },
                        { cat: 'food', jp: 'ã“ã‚Œã‚’ãŠé¡˜ã„ã—ã¾ã™', reading: 'Kore o onegaishimasu', meaning: 'æˆ‘è¦é»é€™å€‹(æŒ‡)' },
                        { cat: 'food', jp: 'ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™', reading: 'Okaikei o onegaishimasu', meaning: 'éº»ç…©çµå¸³' },
                        { cat: 'food', jp: 'ãŠæ°´ã‚’ãã ã•ã„', reading: 'Omizu o kudasai', meaning: 'è«‹çµ¦æˆ‘æ°´' },
                        { cat: 'shop', jp: 'ã“ã‚Œã„ãã‚‰ã§ã™ã‹ï¼Ÿ', reading: 'Kore ikura desu ka?', meaning: 'é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ' },
                        { cat: 'shop', jp: 'å…ç¨ï¼ˆã‚ã‚“ãœã„ï¼‰ã§ãã¾ã™ã‹ï¼Ÿ', reading: 'Menzei dekimasu ka?', meaning: 'å¯ä»¥é€€ç¨…å—ï¼Ÿ' },
                        { cat: 'hotel', jp: 'è·ç‰©ã‚’é ã‹ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', reading: 'Nimotsu o azukatte moraemasu ka?', meaning: 'å¯ä»¥å¯„æ”¾è¡Œæå—ï¼Ÿ' },
                        { cat: 'traffic', jp: 'åˆ‡ç¬¦å£²ã‚Šå ´ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', reading: 'Kippu uriba wa doko desu ka?', meaning: 'å”®ç¥¨è™•åœ¨å“ªè£¡ï¼Ÿ' },
                    ],

                    // --- 2. äº”åéŸ³è³‡æ–™ ---
                    kanaMode: 'hira',
                    kanaTable: [
                        { h: 'ã‚', k: 'ã‚¢', r: 'a' }, { h: 'ã„', k: 'ã‚¤', r: 'i' }, { h: 'ã†', k: 'ã‚¦', r: 'u' }, { h: 'ãˆ', k: 'ã‚¨', r: 'e' }, { h: 'ãŠ', k: 'ã‚ª', r: 'o' },
                        { h: 'ã‹', k: 'ã‚«', r: 'ka' }, { h: 'ã', k: 'ã‚­', r: 'ki' }, { h: 'ã', k: 'ã‚¯', r: 'ku' }, { h: 'ã‘', k: 'ã‚±', r: 'ke' }, { h: 'ã“', k: 'ã‚³', r: 'ko' },
                        { h: 'ã•', k: 'ã‚µ', r: 'sa' }, { h: 'ã—', k: 'ã‚·', r: 'shi' }, { h: 'ã™', k: 'ã‚¹', r: 'su' }, { h: 'ã›', k: 'ã‚»', r: 'se' }, { h: 'ã', k: 'ã‚½', r: 'so' },
                        { h: 'ãŸ', k: 'ã‚¿', r: 'ta' }, { h: 'ã¡', k: 'ãƒ', r: 'chi' }, { h: 'ã¤', k: 'ãƒ„', r: 'tsu' }, { h: 'ã¦', k: 'ãƒ†', r: 'te' }, { h: 'ã¨', k: 'ãƒˆ', r: 'to' },
                        { h: 'ãª', k: 'ãƒŠ', r: 'na' }, { h: 'ã«', k: 'ãƒ‹', r: 'ni' }, { h: 'ã¬', k: 'ãƒŒ', r: 'nu' }, { h: 'ã­', k: 'ãƒ', r: 'ne' }, { h: 'ã®', k: 'ãƒ', r: 'no' },
                        { h: 'ã¯', k: 'ãƒ', r: 'ha' }, { h: 'ã²', k: 'ãƒ’', r: 'hi' }, { h: 'ãµ', k: 'ãƒ•', r: 'fu' }, { h: 'ã¸', k: 'ãƒ˜', r: 'he' }, { h: 'ã»', k: 'ãƒ›', r: 'ho' },
                        { h: 'ã¾', k: 'ãƒ', r: 'ma' }, { h: 'ã¿', k: 'ãƒŸ', r: 'mi' }, { h: 'ã‚€', k: 'ãƒ ', r: 'mu' }, { h: 'ã‚', k: 'ãƒ¡', r: 'me' }, { h: 'ã‚‚', k: 'ãƒ¢', r: 'mo' },
                        { h: 'ã‚„', k: 'ãƒ¤', r: 'ya' }, { h: '', k: '', r: '' }, { h: 'ã‚†', k: 'ãƒ¦', r: 'yu' }, { h: '', k: '', r: '' }, { h: 'ã‚ˆ', k: 'ãƒ¨', r: 'yo' },
                        { h: 'ã‚‰', k: 'ãƒ©', r: 'ra' }, { h: 'ã‚Š', k: 'ãƒª', r: 'ri' }, { h: 'ã‚‹', k: 'ãƒ«', r: 'ru' }, { h: 'ã‚Œ', k: 'ãƒ¬', r: 're' }, { h: 'ã‚', k: 'ãƒ­', r: 'ro' },
                        { h: 'ã‚', k: 'ãƒ¯', r: 'wa' }, { h: '', k: '', r: '' }, { h: 'ã‚’', k: 'ãƒ²', r: 'wo' }, { h: '', k: '', r: '' }, { h: 'ã‚“', k: 'ãƒ³', r: 'n' },
                    ],

                    // --- 3. JLPT è³‡æ–™ (é€£ç·šç‰ˆ) ---
                    currentLevel: 'n5',
                    searchQuery: '',
                    loading: false,
                    vocabDatabase: {}, // å¿«å–ç”¨
                    activeVocabList: [],
                    // è¨­å®šå„ç­‰ç´šçš„è³‡æ–™ä¾†æº (ä½¿ç”¨ tanerijun/jlpt-vocab åº«)
                    sources: {
                        n5: 'https://raw.githubusercontent.com/tanerijun/jlpt-vocab/master/jlpt-n5.json',
                        n4: 'https://raw.githubusercontent.com/tanerijun/jlpt-vocab/master/jlpt-n4.json',
                        n3: 'https://raw.githubusercontent.com/tanerijun/jlpt-vocab/master/jlpt-n3.json',
                        n2: 'https://raw.githubusercontent.com/tanerijun/jlpt-vocab/master/jlpt-n2.json',
                        n1: 'https://raw.githubusercontent.com/tanerijun/jlpt-vocab/master/jlpt-n1.json'
                    }
                }
            },
            computed: {
                pageTitle() {
                    if(this.currentTab === 'talk') return 'æ—…éŠæœƒè©±';
                    if(this.currentTab === 'kana') return 'äº”åéŸ³è¡¨';
                    return 'JLPT å–®å­—åº«';
                },
                filteredConversations() {
                    return this.conversations.filter(c => c.cat === this.currConvCat);
                },
                currentKanaList() {
                    return this.kanaTable.map(item => ({
                        char: this.kanaMode === 'hira' ? item.h : item.k,
                        romaji: item.r
                    }));
                },
                filteredVocab() {
                    const q = this.searchQuery.toLowerCase();
                    if (!q) return this.activeVocabList;
                    return this.activeVocabList.filter(w => 
                        (w.kanji && w.kanji.includes(q)) || 
                        (w.kana && w.kana.includes(q)) || 
                        (w.meaning && w.meaning.toLowerCase().includes(q))
                    );
                }
            },
            mounted() {
                // é è¨­è¼‰å…¥ N5
                this.loadVocabLevel('n5');
            },
            methods: {
                switchTab(tab) {
                    this.currentTab = tab;
                    // åˆ‡æ›æ™‚å›åˆ°é ‚éƒ¨
                    if (this.$refs.mainScroll) this.$refs.mainScroll.scrollTop = 0;
                },
                speak(text) {
                    if (!text) return;
                    if ('speechSynthesis' in window) {
                        const u = new SpeechSynthesisUtterance(text);
                        u.lang = 'ja-JP';
                        u.rate = this.currentTab === 'kana' ? 0.7 : 0.9;
                        window.speechSynthesis.cancel();
                        window.speechSynthesis.speak(u);
                    }
                },
                async loadVocabLevel(level) {
                    this.currentLevel = level;
                    this.searchQuery = ''; 

                    // 1. å¦‚æœä¹‹å‰ä¸‹è¼‰éï¼Œç›´æ¥ç”¨å¿«å–
                    if (this.vocabDatabase[level]) {
                        this.activeVocabList = this.vocabDatabase[level];
                        return;
                    }

                    // 2. é–‹å§‹ä¸‹è¼‰
                    this.loading = true;
                    this.activeVocabList = []; // æ¸…ç©ºåˆ—è¡¨é¿å…æ··æ·†

                    try {
                        const url = this.sources[level];
                        const res = await fetch(url);
                        
                        if (!res.ok) throw new Error("ç¶²è·¯é€£ç·šéŒ¯èª¤");
                        
                        const rawData = await res.json();
                        
                        // 3. è³‡æ–™æ ¼å¼è½‰æ› (Data Mapping)
                        // tanerijun çš„æ ¼å¼æ˜¯: { kanji, kana, meanings: [] }
                        // æˆ‘å€‘è¦è½‰æˆ: { kanji, kana, meaning: "..." }
                        const cleanData = rawData.map(item => ({
                            kanji: item.kanji,
                            kana: item.kana,
                            // å°‡é™£åˆ—æ„æ€ç”¨é€—è™Ÿä¸²æ¥ï¼Œä¸”åªå–å‰ 3 å€‹æ„æ€é¿å…å¤ªé•·
                            meaning: item.meanings ? item.meanings.slice(0, 3).join(', ') : '(ç„¡è§£é‡‹)'
                        }));

                        // å­˜å…¥å¿«å–ä¸¦é¡¯ç¤º
                        this.vocabDatabase[level] = cleanData;
                        this.activeVocabList = cleanData;

                    } catch (e) {
                        console.error(e);
                        alert(`è®€å– ${level.toUpperCase()} è³‡æ–™å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²è·¯é€£ç·šã€‚`);
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
